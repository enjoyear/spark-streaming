# docker search jupyter
# jupyter/pyspark-notebook:latest uses Spark 3.5
# almondsh/almond:latest uses Spark 4.0, but has Java 8
FROM jupyter/base-notebook:latest

USER root

RUN set -eux

# Only minimal tools; base image usually has curl + CA already. If not, add them once.
RUN rm -rf /var/lib/apt/lists/*; apt-get update; \
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends ca-certificates curl; \
    rm -rf /var/lib/apt/lists/*

# Arch-aware Temurin JDK install. Try latest GA first
ARG JDK_MAJOR=17
ARG JDK_BUILD=17.0.13+11

RUN arch="$(uname -m)"; \
    case "$arch" in \
      aarch64) ARCH=aarch64 ;; \
      x86_64)  ARCH=x64 ;; \
      *) echo "unsupported arch: $arch"; exit 1 ;; \
    esac; \
    curl -fsSL "https://api.adoptium.net/v3/binary/latest/${JDK_MAJOR}/ga/linux/${ARCH}/jdk/hotspot/normal/eclipse" -o /tmp/jdk.tar.gz \
    || curl -fsSL "https://api.adoptium.net/v3/binary/version/jdk-${JDK_BUILD}/linux/${ARCH}/jdk/hotspot/normal/eclipse" -o /tmp/jdk.tar.gz; \
    mkdir -p /opt/java; \
    tar -xzf /tmp/jdk.tar.gz -C /opt/java --strip-components=1; \
    rm -f /tmp/jdk.tar.gz

ENV JAVA_HOME=/opt/java
ENV PATH=$JAVA_HOME/bin:$PATH

USER jovyan

# Install Almond (Scala kernel) for Java 17
RUN curl -Lo coursier https://git.io/coursier-cli && \
    chmod +x coursier && \
    ./coursier launch --fork almond:0.14.1 --scala 2.13.16 -- --install && \
    rm -f coursier

# Optional: Pre-install Python packages if you want Python support
RUN pip install --no-cache-dir \
    pandas \
    numpy \
    matplotlib

WORKDIR /home/jovyan